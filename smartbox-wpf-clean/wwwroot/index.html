<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>SmartBox Next - Touch Medical Imaging</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles-elegant.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/segoe-fluent-icons/font/SegoeFluentIcons.css">
    <style>
        /* Segoe MDL2 Assets für Windows Icons */
        @font-face {
            font-family: 'Segoe MDL2 Assets';
            src: local('Segoe MDL2 Assets');
        }
        
        .icon-mdl2 {
            font-family: 'Segoe MDL2 Assets', 'Segoe UI Symbol';
            font-style: normal;
            font-weight: normal;
            line-height: 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
    <link rel="stylesheet" href="css/video-editing.css">
    <link rel="stylesheet" href="css/timeline-buttons.css">
</head>
<body>
    <div class="app-container">
        <!-- Fixed Header - 80px -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">SmartBox Next</h1>
                <div class="patient-status" id="patientStatus">
                    <span id="patientStatusText">Kein Patient</span>
                </div>
                <button class="exit-button" id="exitButton" data-action="exitapp" aria-label="Beenden">
                    <i class="ms-Icon ms-Icon--ChromeClose"></i>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent">
            
            <!-- Mode: Patient Selection -->
            <div class="mode-container" id="patientMode">
                <!-- MWL Table Container -->
                <div class="mwl-container" id="mwlContainer">
                    <div class="mwl-header">
                        <h2>Patientenliste</h2>
                        <div class="mwl-controls">
                            <div class="mwl-filter">
                                <input type="text" 
                                       id="mwlFilter" 
                                       placeholder="Suchen..." 
                                       class="filter-input">
                            </div>
                            <div class="mwl-date-selector">
                                <select id="mwlDateRange" class="date-range-select">
                                    <option value="today">Heute</option>
                                    <option value="3days" selected>3 Tage (Gestern - Morgen)</option>
                                    <option value="week">Diese Woche</option>
                                    <option value="custom">Benutzerdefiniert...</option>
                                </select>
                                <input type="date" id="mwlDateFrom" class="date-input hidden" />
                                <input type="date" id="mwlDateTo" class="date-input hidden" />
                            </div>
                            <div class="theme-selector">
                                <button class="theme-button active" data-theme="medical-blue">Blau</button>
                                <button class="theme-button" data-theme="medical-teal">Türkis</button>
                                <button class="theme-button" data-theme="dark">Dunkel</button>
                            </div>
                        </div>
                    </div>

                    <div class="mwl-table-container" id="mwlTableContainer">
                        <table class="mwl-table" id="mwlTable">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="name">
                                        <span>Name</span>
                                        <span class="sort-indicator">▲</span>
                                    </th>
                                    <th class="sortable" data-sort="firstName">
                                        <span>Vorname</span>
                                        <span class="sort-indicator"></span>
                                    </th>
                                    <th class="sortable" data-sort="birthDate">
                                        <span>Geburtsdatum</span>
                                        <span class="sort-indicator"></span>
                                    </th>
                                    <th data-sort="gender">
                                        <span>Geschlecht</span>
                                    </th>
                                    <th class="sortable" data-sort="studyDate">
                                        <span>Untersuchungsdatum</span>
                                        <span class="sort-indicator"></span>
                                    </th>
                                    <th data-sort="studyType">
                                        <span>Untersuchungsart</span>
                                    </th>
                                    <th data-sort="location">
                                        <span>Geplanter Ort</span>
                                    </th>
                                    <th data-sort="comment">
                                        <span>Kommentar</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="mwlTableBody">
                                <!-- Table rows will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Right Sidebar -->
                <div class="sidebar-container">
                    <!-- Video Preview Section -->
                    <div class="preview-section">
                        <div class="preview-container">
                            <video id="webcamPreviewSmall" autoplay playsinline muted></video>
                            <div class="preview-overlay">
                                <i class="ms-Icon ms-Icon--Camera"></i>
                                <span>Kamera bereit</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Patient Details -->
                    <div class="patient-details" id="patientDetails">
                        <div class="detail-section">
                            <div class="detail-label">Patient</div>
                            <div class="detail-value large" id="selectedPatientName">Kein Patient ausgewählt</div>
                        </div>
                        
                        <div class="detail-grid">
                            <div class="detail-section">
                                <div class="detail-label">Geburtsdatum</div>
                                <div class="detail-value" id="selectedBirthDate">-</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-label">Geschlecht</div>
                                <div class="detail-value" id="selectedGender">-</div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">Untersuchung</div>
                            <div class="detail-value" id="selectedStudyType">-</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">Geplanter Termin</div>
                            <div class="detail-value" id="selectedStudyDate">-</div>
                        </div>
                    </div>
                    
                    <!-- Status Display -->
                    <div class="status-display">
                        <div class="status-item">
                            <div class="status-indicator connected"></div>
                            <span class="status-label">AET:</span>
                            <span class="status-value" id="connectedAET">SMARTBOX_01</span>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator connected"></div>
                            <span class="status-label">IP:</span>
                            <span class="status-value" id="localIP">192.168.1.100</span>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator" id="pacsIndicator"></div>
                            <span class="status-label">PACS:</span>
                            <span class="status-value" id="pacsStatus">Verbunden</span>
                        </div>
                    </div>
                    
                    <!-- Bottom Bar -->
                    <div class="bottom-bar">
                        <div class="clock-display" id="clockDisplay">14:32</div>
                        <button class="settings-button" id="sidebarSettingsButton" data-action="opensettings">
                            <i class="ms-Icon ms-Icon--Settings"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Emergency Patient Swipe Area -->
                <div class="emergency-swipe-container">
                    <div class="emergency-hint">
                        <i class="ms-Icon ms-Icon--Warning"></i>
                        <span>Wischen für Notfall-Patient</span>
                        <i class="ms-Icon ms-Icon--DoubleChevronRight"></i>
                    </div>
                    <div class="emergency-swipe-area" id="emergencySwipe">
                        <div class="emergency-options">
                            <div class="emergency-option" data-type="male">
                                <i class="ms-Icon ms-Icon--Contact"></i>
                                <span>Notfall Mann</span>
                            </div>
                            <div class="emergency-option" data-type="female">
                                <i class="ms-Icon ms-Icon--ContactCard"></i>
                                <span>Notfall Frau</span>
                            </div>
                            <div class="emergency-option" data-type="child">
                                <i class="ms-Icon ms-Icon--ChildrenFolderFill"></i>
                                <span>Notfall Kind</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mode: Recording -->
            <div class="mode-container hidden" id="recordingMode">
                <!-- Patient Info Bar -->
                <div class="patient-info-bar">
                    <button class="back-button" id="backToPatientSelection" aria-label="Zurück zur Patientenauswahl">
                        <i class="ms-Icon ms-Icon--Back"></i>
                        <span>Zurück</span>
                    </button>
                    <div class="patient-data">
                        <i class="ms-Icon ms-Icon--Contact"></i>
                        <span id="recordingPatientName">-</span>
                        <span class="separator">|</span>
                        <i class="ms-Icon ms-Icon--NumberField"></i>
                        <span id="recordingPatientId">-</span>
                        <span class="separator">|</span>
                        <i class="ms-Icon ms-Icon--Medical"></i>
                        <span id="recordingStudyType">-</span>
                    </div>
                </div>

                <!-- Large Preview Area -->
                <div class="preview-large">
                    <div class="preview-container" id="captureArea">
                        <video id="webcamPreviewLarge" autoplay playsinline muted></video>
                        <canvas id="captureCanvas" style="display: none;"></canvas>
                        
                        <!-- Prerecording Buttons Overlay -->
                        <div class="prerecording-overlay" id="prerecordingOverlay">
                            <button class="prerecording-btn" id="prerecord60" data-duration="60" title="60 Sekunden Voraufzeichnung">60s</button>
                            <button class="prerecording-btn" id="prerecord30" data-duration="30" title="30 Sekunden Voraufzeichnung">30s</button>
                            <button class="prerecording-btn" id="prerecord10" data-duration="10" title="10 Sekunden Voraufzeichnung">10s</button>
                        </div>
                        
                        <!-- Capture Overlay -->
                        <div class="capture-overlay">
                            <div class="capture-hint" id="captureHint">
                                <i class="ms-Icon ms-Icon--Camera"></i>
                                <span>Antippen zum Fotografieren</span>
                                <br>
                                <small>Gedrückt halten für Video</small>
                            </div>
                            
                            <!-- Recording Indicator -->
                            <div class="recording-indicator hidden" id="recordingIndicator">
                                <div class="rec-dot"></div>
                                <span id="recordingTime">00:00</span>
                            </div>
                            
                            <!-- Enhanced Status Indicators for Phase 1 -->
                            <div class="status-indicators">
                                <div class="status-item" id="recordingStatus">Ready</div>
                                <div class="status-item" id="segmentIndicator">-</div>
                                <div class="status-item" id="pauseIndicator"></div>
                                <div class="error-indicator" id="errorIndicator"></div>
                            </div>
                        </div>
                        
                        <!-- Video Recording Controls -->
                        <div class="recording-controls">
                            <button class="control-button" id="capturePhotoButton" data-action="capturephoto" aria-label="Foto aufnehmen">
                                <i class="ms-Icon ms-Icon--Camera"></i>
                                <span>Foto</span>
                            </button>
                            <button class="control-button toggle-video" id="toggleVideoButton" data-action="togglevideo" aria-label="Video aufnehmen">
                                <i class="ms-Icon ms-Icon--Video"></i>
                                <span>Video starten</span>
                            </button>
                            <button class="control-button mark-critical hidden" id="markCriticalMomentButton" data-action="markcritical" aria-label="Kritischen Moment markieren">
                                <i class="ms-Icon ms-Icon--Flag"></i>
                                <span>Markieren</span>
                            </button>
                        </div>

                        <!-- Touch Feedback -->
                        <div class="touch-feedback" id="touchFeedback"></div>
                    </div>
                </div>

                <!-- Professional Video Timeline -->
                <div id="videoTimeline" class="video-timeline-container">
                    <div class="timeline-container"></div>
                </div>

                <!-- Thumbnail Strip -->
                <div class="thumbnail-strip-container">
                    <div class="strip-header">
                        <span>Aufnahmen</span>
                        <span class="swipe-hint">← Wischen zum Durchblättern →</span>
                    </div>
                    <div class="thumbnail-strip" id="thumbnailStrip">
                        <div class="thumbnail-scroll" id="thumbnailScroll">
                            <!-- Thumbnails will be inserted here -->
                            <!-- Example:
                            <div class="thumbnail" data-index="0">
                                <img src="..." alt="Aufnahme 1">
                                <div class="thumbnail-type">
                                    <i class="ms-Icon ms-Icon--Camera"></i>
                                </div>
                                <div class="thumbnail-number">#1</div>
                            </div>
                            -->
                            <div class="thumbnail add-new" id="addNewThumbnail">
                                <i class="ms-Icon ms-Icon--Add"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Export Button -->
                <div class="export-section">
                    <button class="export-button" id="exportButton" data-action="exportcaptures">
                        <i class="ms-Icon ms-Icon--Export"></i>
                        <span>Alle an PACS senden</span>
                        <small id="exportCount">(0 Aufnahmen)</small>
                    </button>
                </div>
            </div>
        </main>

        <!-- Dialog Container -->
        <div class="dialog-backdrop hidden" id="dialogBackdrop">
            <div class="dialog" id="dialogBox">
                <div class="dialog-header">
                    <h3 id="dialogTitle">Titel</h3>
                </div>
                <div class="dialog-body">
                    <p id="dialogMessage">Nachricht</p>
                </div>
                <div class="dialog-buttons">
                    <button class="dialog-button cancel" id="dialogCancel">
                        <i class="ms-Icon ms-Icon--Cancel"></i>
                        <span>Abbrechen</span>
                    </button>
                    <button class="dialog-button confirm" id="dialogConfirm">
                        <i class="ms-Icon ms-Icon--CheckMark"></i>
                        <span>OK</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay hidden" id="loadingOverlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p id="loadingText">Wird geladen...</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/timeline-component.js"></script>
    <script src="js/timeline-integration.js"></script>
    <script src="js/actions.js"></script>
    <script src="js/button-actions.js"></script>
    <script src="js/touch_gestures.js"></script>
    <script src="js/touch_dialogs.js"></script>
    <script src="js/mode_manager.js"></script>
    <script src="js/video-player-component.js"></script>
    <script src="js/jogwheel-control.js"></script>
    <script src="js/adaptive-timeline.js"></script>
    <script src="js/playhead-controls.js"></script>
    <script src="js/video-editor-component.js"></script>
    <script src="js/medical-annotation-tools.js"></script>
    <script src="js/video-workflow-integration.js"></script>
    <script src="js/video-engine-client.js"></script>
    <script src="js/streaming-websocket-handler.js"></script>
    <script src="js/phase1-error-recovery.js"></script>
    <script src="js/phase1-testing.js"></script>
    <script src="app.js"></script>
    <!-- <script src="debug_overlay.js"></script> -->
</body>
</html>